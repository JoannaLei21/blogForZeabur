<!DOCTYPE html>
<html lang="en"
  x-data
  :class="$store.darkMode.class()"
  :data-theme="$store.darkMode.theme()">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Line Pay Apiä¸²æ¥ | Joanna&#39;s Blog</title>

    
<link href="/favicon.ico" rel="icon" type="image/x-icon" />


<link rel="canonical" href="/posts/18th-linepayapi/" />



<meta name="author" content="Joanna Lei" />
<meta name="description" content="ä½¿ç”¨ Django ä¸²æ¥ Line Pay
" />


<meta name="keywords" content="Project">



<meta name="generator" content="Hugo 0.140.1">


<meta property="og:url" content="/posts/18th-linepayapi/">
  <meta property="og:site_name" content="Joanna&#39;s Blog">
  <meta property="og:title" content="Line Pay Apiä¸²æ¥">
  <meta property="og:description" content="ä½¿ç”¨ Django ä¸²æ¥ Line Pay">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2024-12-21T00:00:00+00:00">
    <meta property="article:modified_time" content="2024-12-21T00:00:00+00:00">
    <meta property="article:tag" content="Project">




  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Line Pay Apiä¸²æ¥">
  <meta name="twitter:description" content="ä½¿ç”¨ Django ä¸²æ¥ Line Pay">




  

<link rel="stylesheet" href="/css/output.min.css" />




    


<style>
  pre {
    padding: 1em;
    overflow: auto;
  }
</style>









    

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </head>

  <body x-data="{
    flip: false,
  }">
    
    <div id="dream-global-bg"></div>

    
<nav class="mt-4 lg:mt-8 py-4">

  
  <div class="container flex justify-between px-4">
  
    <section class="flex items-center gap-4">
      <div class="avatar cursor-pointer hover:online" @click="flip = !flip" title="Flip it!">
        <div class="h-10 rounded-full">
          <img src="/cat.png" alt="Joanna&#39;s Bolg" />
        </div>
      </div>

      
      <div>
        
        <a href="/" class="text-lg font-semibold cursor-pointer">
          Joanna&#39;s Bolg
        </a>
        
        
      </div>
      
    </section>

    <div class="dropdown dropdown-end sm:hidden">
      <div tabindex="0" role="button" class="btn btn-ghost btn-square" aria-label="Select an option">
        <ion-icon name="menu" class="text-2xl"></ion-icon>
      </div>
      <ul tabindex="0" class="dropdown-content menu w-36 bg-base-100 rounded-box z-[1] shadow-md">
        


<li>
  <div role="link" tabindex="0" class="inline-flex items-center p-2 cursor-pointer" @click="flip = !flip" title="About">
    <ion-icon name="information-circle"></ion-icon>About</div>
</li>





















<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/posts" title="Archives">
    <ion-icon name="archive"></ion-icon>
    Archives
  </a>
</li>




<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/categories" title="All Categories">
    <ion-icon name="grid"></ion-icon>
    All Categories
  </a>
</li>




<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/tags" title="All Tags">
    <ion-icon name="pricetags"></ion-icon>
    All Tags
  </a>
</li>






      </ul>
    </div>
    <section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4">
      
      
      
      <div role="link" tabindex="0" class="text-sm font-semibold cursor-pointer hover:underline" @click="flip = !flip" title="About">About</div>
      
      

      
      

      

      
      





      
      





      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/posts" title="Archives">
  <ion-icon class="group-hover:text-primary-content" name="archive"></ion-icon>
</a>


      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/categories" title="All Categories">
  <ion-icon class="group-hover:text-primary-content" name="grid"></ion-icon>
</a>


      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/tags" title="All Tags">
  <ion-icon class="group-hover:text-primary-content" name="pricetags"></ion-icon>
</a>


      

      

      
    </section>
  </div>
</nav>


    <div class="flip-container" :class="{ 'flip-it': flip }">
      <div class="flipper">
        <div class="front">
          <div class="container">
            
<div class="mt-4 px-4">
  
  <div class="relative" x-data="{ height: '' }" x-init="height = $el.scrollHeight + 'px'">
  
    
    <div class="absolute right-0 lg:w-36 xl:w-48 hidden lg:block" :style="{ height }">
      <nav id="TableOfContents">
  <ul>
    <li><a href="#é—œæ–¼ä¸²æ¥-line-pay-é€™å›äº‹">é—œæ–¼ä¸²æ¥ Line Pay é€™å›äº‹</a>
      <ul>
        <li><a href="#ä½¿ç”¨-postman">ä½¿ç”¨ Postmanï¼Ÿ</a></li>
        <li><a href="#å…·é«”å·®åˆ¥æ¯”è¼ƒ">å…·é«”å·®åˆ¥æ¯”è¼ƒ</a></li>
      </ul>
    </li>
    <li><a href="#ä¸²æ¥å‰æº–å‚™">ä¸²æ¥å‰æº–å‚™</a>
      <ul>
        <li><a href="#1ç”³è«‹line-pay-sandboxhttpsdevelopers-paylinemezhsandbox">1.ç”³è«‹<a href="https://developers-pay.line.me/zh/sandbox">Line Pay Sandbox</a></a></li>
        <li><a href="#2ç”³è«‹è‡¨æ™‚ä¼ºæœå™¨ngrokhttpsngrokcom">2.ç”³è«‹è‡¨æ™‚ä¼ºæœå™¨<a href="https://ngrok.com/">ngrok</a></a></li>
      </ul>
    </li>
    <li><a href="#é–‹å§‹ä¸²æ¥">é–‹å§‹ä¸²æ¥</a>
      <ul>
        <li><a href="#1æœ€ç°¡å–®çš„-html">1.æœ€ç°¡å–®çš„ html</a></li>
        <li><a href="#2env-ç’°å¢ƒè®Šæ•¸">2..env ç’°å¢ƒè®Šæ•¸</a></li>
        <li><a href="#3settingpy">3.setting.py</a></li>
        <li><a href="#4urlspy-è¨­å®šè·¯å¾‘">4.<code>urls.py</code> è¨­å®šè·¯å¾‘</a></li>
        <li><a href="#5viewpy-è¨­å®šåŠŸèƒ½">5.<code>view.py</code> è¨­å®šåŠŸèƒ½</a></li>
      </ul>
    </li>
    <li><a href="#æ¸¬è©¦">æ¸¬è©¦</a>
      <ul>
        <li><a href="#æˆåŠŸé€£æ¥">æˆåŠŸé€£æ¥</a></li>
        <li><a href="#é€£æ¥å¤±æ•—">é€£æ¥å¤±æ•—</a></li>
      </ul>
    </li>
  </ul>
</nav>

      <div class="dream-adsense px-5">
      
      </div>
    </div>
    
    <article class="mx-auto prose prose-quoteless dark:prose-invert" id="dream-single-post-main" itemscope itemtype="http://schema.org/Article">
      
  <meta itemprop="name" content="Line Pay Apiä¸²æ¥">
  <meta itemprop="description" content="ä½¿ç”¨ Django ä¸²æ¥ Line Pay">
  <meta itemprop="datePublished" content="2024-12-21T00:00:00+00:00">
  <meta itemprop="dateModified" content="2024-12-21T00:00:00+00:00">
  <meta itemprop="wordCount" content="2371">
  <meta itemprop="keywords" content="Project">

      <header>
        <h1 itemprop="headline">Line Pay Apiä¸²æ¥</h1>
        <p class="text-sm">
          
            Saturday, Dec 21, 2024
          

          | <span>5 minute read</span>

          
          | <span>Updated at
            
              Saturday, Dec 21, 2024
            </span>
          
        </p>
        <div class="flex justify-between">
          <div class="flex items-center">
  
  <span>@</span>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">Joanna Lei</span>
    
  
  </span>
</div>


          <div class="flex items-center gap-2">
  
  

  
  
  
  
  
    <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary"
      href="https://x.com/intent/post?text=Line%20Pay%20Api%e4%b8%b2%e6%8e%a5&amp;url=/posts/18th-linepayapi/" target="_blank" rel="noopener noreferrer"
      title="Share on X">
      <ion-icon class="group-hover:text-primary-content" name="logo-x"></ion-icon>
    </a>
  
    <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary"
      href="https://facebook.com/sharer/sharer.php?u=/posts/18th-linepayapi/" target="_blank" rel="noopener noreferrer"
      title="Share on Facebook">
      <ion-icon class="group-hover:text-primary-content" name="logo-facebook"></ion-icon>
    </a>
  
    <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary"
      href="https://wa.me/?text=Line%20Pay%20Api%e4%b8%b2%e6%8e%a5%20/posts/18th-linepayapi/" target="_blank" rel="noopener noreferrer"
      title="Share on WhatsApp">
      <ion-icon class="group-hover:text-primary-content" name="logo-whatsapp"></ion-icon>
    </a>
  

  
  
</div>

        </div>
      </header>

      
      <img src="/img/LinePay.png" alt="Line Pay Apiä¸²æ¥" />
      

      <p>ä½¿ç”¨ Django ä¸²æ¥ Line Pay</p>
<h2 id="é—œæ–¼ä¸²æ¥-line-pay-é€™å›äº‹">é—œæ–¼ä¸²æ¥ Line Pay é€™å›äº‹</h2>
<h3 id="ä½¿ç”¨-postman">ä½¿ç”¨ Postmanï¼Ÿ</h3>
<p>å¾ˆå¤šè³‡æºä»‹ç´¹å¦‚ä½•ä¸² Line Pay Apiï¼Œè®“ Line Pay åœ¨çµå¸³é é¢å‡ºç¾ï¼Œä¸¦é€£æ¥åˆ°æ¶ˆè²»è€…çš„ Line å¸³è™Ÿï¼Œé€£å‹• LinePay é€²è¡Œä»˜æ¬¾ã€‚<br>
å¤§éƒ¨åˆ†çš„è³‡æºçš†æ˜¯é€é <code>Postman</code>ä¾†é€²è¡Œä¸²æ¥ï¼ŒåŸºæœ¬çš„æ­¥é©Ÿå¾ˆç°¡å–®ï¼Œè¨­ç½®è¨˜å€‹åŸºæœ¬åƒæ•¸åŸºæœ¬å°±å¯ä»¥æå®šã€‚
ä»Šå¤©è¦ä»‹ç´¹çš„ï¼Œæ˜¯ä½¿ç”¨<code>Django</code>ä¾†ç›´æ¥ä¸²æ¥ Line Payï¼Œæ¶‰äº‹çš„æ±è¥¿ç¨å¾®å¤šä¸€äº›ã€‚<br>
æˆ–è¨±ä½ æœƒæœ‰ç–‘å•ï¼Œç‚ºä»€éº¼æœ‰ç°¡å–®çš„å·¥å…·æ”¾è‘—ä¸ç”¨ï¼Œé›£é“ Django ä¸èƒ½ä¸² Postmanï¼Ÿ<br>
é€™å€‹å•é¡Œæˆ‘è©¢å•äº† Aiï¼Œç­”æ¡ˆæ˜¯â€œå¯ä»¥â€ï¼ä½†å°šæœªå¯¦éš›é©—è­‰ã€‚é‚£å·®åˆ¥å‘¢ï¼Ÿä¾†çœ‹ Ai æ€éº¼èªª</p>
<h3 id="å…·é«”å·®åˆ¥æ¯”è¼ƒ">å…·é«”å·®åˆ¥æ¯”è¼ƒ</h3>
<table>
  <thead>
      <tr>
          <th style="text-align: center">åŠŸèƒ½</th>
          <th style="text-align: left">ä½¿ç”¨ Postman</th>
          <th style="text-align: left">ä¸ä½¿ç”¨ Postman</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: center">æ¸¬è©¦å•Ÿå‹•æ™‚é–“</td>
          <td style="text-align: left">å¿«é€Ÿï¼ˆå¹¾åˆ†é˜å³å¯æ¸¬è©¦ï¼‰</td>
          <td style="text-align: left">éœ€è¦è¨­ç½®å‰ç«¯æˆ–æ’°å¯«æ¸¬è©¦ä»£ç¢¼ï¼Œè¼ƒè€—æ™‚</td>
      </tr>
      <tr>
          <td style="text-align: center">é‡è¤‡æ¸¬è©¦</td>
          <td style="text-align: left">æ”¯æ´å„²å­˜è«‹æ±‚ä¸¦å¿«é€Ÿé‡è¤‡æ¸¬è©¦</td>
          <td style="text-align: left">é‡è¤‡æ¸¬è©¦éœ€è¦å¤šæ¬¡æ“ä½œæˆ–åŸ·è¡Œæ¸¬è©¦ä»£ç¢¼</td>
      </tr>
      <tr>
          <td style="text-align: center">éŒ¯èª¤è¨ºæ–·èˆ‡å›æ‡‰åˆ†æ</td>
          <td style="text-align: left">æä¾›å³æ™‚å¯è¦–åŒ–å›æ‡‰ï¼Œæ–¹ä¾¿æª¢æŸ¥</td>
          <td style="text-align: left">éœ€è¦æª¢æŸ¥æ—¥èªŒæˆ–æ‰“å°è³‡æ–™</td>
      </tr>
      <tr>
          <td style="text-align: center">æ¸¬è©¦ç¯„åœ</td>
          <td style="text-align: left">èšç„¦æ–¼å¾Œç«¯ API çš„è¡Œç‚º</td>
          <td style="text-align: left">æ¶µè“‹æ•´å€‹ç³»çµ±ï¼ŒåŒ…æ‹¬å‰ç«¯ã€å¾Œç«¯èˆ‡æ•´åˆæµç¨‹</td>
      </tr>
      <tr>
          <td style="text-align: center">é–‹ç™¼é€²åº¦éœ€æ±‚</td>
          <td style="text-align: left">é©åˆå¾Œç«¯ç¨ç«‹æ¸¬è©¦</td>
          <td style="text-align: left">å‰å¾Œç«¯éœ€é€²ä¸€æ­¥æ•´åˆå¾Œæ¸¬è©¦</td>
      </tr>
      <tr>
          <td style="text-align: center">æŒçºŒæ¸¬è©¦è‡ªå‹•åŒ–èƒ½åŠ›</td>
          <td style="text-align: left">ä¸æ”¯æ´ï¼ˆéœ€æ‰‹å‹•æ¸¬è©¦ï¼‰</td>
          <td style="text-align: left">å¯é€éæ’°å¯«ä»£ç¢¼å¯¦ç¾è‡ªå‹•åŒ–æ¸¬è©¦æµç¨‹</td>
      </tr>
  </tbody>
</table>
<p>ç¸½çµ:</p>
<ul>
<li>é–‹ç™¼æ—©æœŸï¼šPostman æ˜¯æ¸¬è©¦å¾Œç«¯ API çš„æœ€ä½³å·¥å…·ï¼Œèƒ½å¿«é€Ÿæ¸¬è©¦ä¸¦æª¢æŸ¥å›æ‡‰ï¼Œé©åˆå–®ç¨æ¸¬è©¦å¾Œç«¯é‚è¼¯ã€‚</li>
<li>é–‹ç™¼å¾ŒæœŸï¼šæ•´åˆå‰ç«¯å¾Œï¼Œå¯é€²è¡Œå…¨æµç¨‹æ¸¬è©¦ï¼Œä¸ä½¿ç”¨ Postman æ›´è²¼è¿‘ç”¨æˆ¶å¯¦éš›æ“ä½œï¼›åŒæ™‚å»ºè­°æ’°å¯«å–®å…ƒæ¸¬è©¦æˆ–é›†æˆæ¸¬è©¦ä»£ç¢¼ï¼Œç‚ºé•·æœŸç¶­è­·æä¾›ä¿éšœã€‚</li>
</ul>
<p>æ‰€ä»¥é›–ç„¶èªªä½¿ç”¨ Postman èƒ½çœäº‹ä¸€äº›ï¼Œä½†èº«ç‚ºä¸€å€‹ç›®æ¨™ç™¾è¬å¹´è–ªçš„å·¥ç¨‹å¸«ï¼Œé‚„æ˜¯è »å€¼å¾—äº†è§£ä¸€ä¸‹åŸç†è‡ªå·±å¯« code çš„ï¼Œå°å§ï½</p>
<h2 id="ä¸²æ¥å‰æº–å‚™">ä¸²æ¥å‰æº–å‚™</h2>
<p>åœ¨æ­£å¼é–‹å§‹å¯« code ä¹‹å‰ï¼Œéœ€è¦å…ˆæº–å‚™å¥½ä¸‹é¢çš„å¿…è¦è³‡æ–™</p>
<h3 id="1ç”³è«‹line-pay-sandboxhttpsdevelopers-paylinemezhsandbox">1.ç”³è«‹<a href="https://developers-pay.line.me/zh/sandbox">Line Pay Sandbox</a></h3>
<ul>
<li>ç”³è«‹å®Œå¾Œï¼Œç™»å…¥ Line Pay è¼¸å…¥å¯„åˆ° Email çš„é©—è­‰ç¢¼</li>
<li>åœ¨å·¦å´é¸å–®ä¸­ï¼Œå¾<code>ç®¡ç†ä»˜æ¬¾é€£çµ</code> é»é€² <code>ç®¡ç†é€£çµé‡‘é‘°</code></li>
<li>é»é¸æŸ¥è©¢ï¼Œä¸¦å¡«å…¥å‚³è‡³ Email çš„é©—è­‰ç¢¼</li>
<li>ä¸‹æ–¹é¡¯ç¤ºå‡º<code>channel ID</code>å’Œ<code>channel secret key</code>ï¼Œå»ºè­°å…ˆè¤‡è£½è‡³<code>.env</code>ï¼Œå› ç‚ºé é¢éä¸€æ®µæ™‚é–“æœƒè‡ªå‹•ç™»å‡ºï¼Œè¦å†é‡è¼¸å¸³å¯†ï¼Œå°éº»ç…©
<img src="/images/LinePayCreat.png" alt="LinePayCreat"></li>
</ul>
<h3 id="2ç”³è«‹è‡¨æ™‚ä¼ºæœå™¨ngrokhttpsngrokcom">2.ç”³è«‹è‡¨æ™‚ä¼ºæœå™¨<a href="https://ngrok.com/">ngrok</a></h3>
<ul>
<li>ç”³è«‹å¾Œï¼Œé€²è¡Œ Email é©—è­‰ä¸¦ç™»å…¥</li>
<li>åœ¨é é¢å·¦å´æœ‰è¡¨å–®ï¼Œæ‰¾åˆ°ç¬¬äºŒè¡Œ<code>Stepup &amp; Installation</code></li>
<li>é¸æ“‡ä½ çš„è£ç½®ï¼Œä¸¦æŒ‰ç…§é †åºè·‘æŒ‡ä»¤ï¼Œæˆ‘ä½¿ç”¨ macOSï¼ŒæŒ‡ä»¤æœ‰ä¸‰å€‹:<br>
1.å®‰è£<code>brew install ngrok</code><br>
2.è·‘<code>ngrok config add-authtoken &lt;your token&gt;</code><br>
3.é€²å…¥<code>ngrok http http://localhost:8080</code></li>
<li>å®Œæˆä¸Šé¢æ­¥é©Ÿï¼Œåœ¨çµ‚ç«¯æ©Ÿå°±æœƒå‡ºç¾ ngrok çš„ä»‹é¢
<img src="/images/ngrok.png" alt="nrgok"></li>
</ul>
<h2 id="é–‹å§‹ä¸²æ¥">é–‹å§‹ä¸²æ¥</h2>
<p>æº–å‚™å¥½ä¹‹å¾Œï¼Œæˆ‘å€‘å°±å¯ä»¥é–‹å§‹äº†ï¼
é€™é‚Šæœƒç·¨è¼¯çš„æª”æ¡ˆæœ‰ï¼š</p>
<ul>
<li><code>setting.py</code> ä¸²æ¥.envã€HOSTSã€CSRF</li>
<li><code>.env</code> æ”¾ç½®ç’°å¢ƒè®Šæ•¸</li>
<li><code>view.py</code> è¨­å®šåŠŸèƒ½</li>
<li><code>urls.py</code> è¨­å®šè·¯å¾‘</li>
<li><code>checkout.htnl</code> å»ºç«‹ Line ä»˜æ¬¾é é¢ï¼Œæœƒé€£ç·šåˆ° Line çš„ç³»çµ±</li>
<li><code>error.html</code> å»ºç«‹ä»˜æ¬¾å¤±æ•—é é¢ï¼Œæ²’æœ‰é€£ç·šæˆåŠŸæ™‚æœƒå‡ºç¾</li>
</ul>
<h3 id="1æœ€ç°¡å–®çš„-html">1.æœ€ç°¡å–®çš„ html</h3>
<p>æº–å‚™ç‡’è…¦å‰ï¼Œå¯ä»¥å…ˆæŠŠç„¡è…¦çš„ html çµ¦å»ºç«‹å‡ºä¾†ï¼Œæœƒæœ‰å…©å€‹é é¢ï¼Œé€™é‚Šå…ˆè¨­å®šæœ€ç°¡å–®çš„æ¶æ§‹ï¼Œæ¨£å¼å¯ä»¥ä¹‹å¾Œèª¿æ•´ã€‚<br>
æ”¾ç½®ä½ç½®<code>/yourapp/templates/payment/xxx.html</code></p>
<p>1.<code>checkout.htnl</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!-- æ”¹tiltle --&gt;</span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;LINE Pay Checkout&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% static &#39;dist/bundle.css&#39; %}&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module&#34;</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% static &#39;dist/bundle.js&#39; %}&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- å¾Œé¢å†åŠ æ¨£å¼ --&gt;</span>
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h1</span>&gt;LINE Pay æ¸¬è©¦çµå¸³&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">form</span> <span style="color:#a6e22e">method</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;POST&#34;</span>&gt;
</span></span><span style="display:flex;"><span>      {% csrf_token %}
</span></span><span style="display:flex;"><span>      &lt;<span style="color:#f92672">button</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;submit&#34;</span>&gt;å‰å¾€ä»˜æ¬¾&lt;/<span style="color:#f92672">button</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;/<span style="color:#f92672">form</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><p>é é¢é•·é€™æ¨£ï¼Œåªæœ‰å…©è¡Œå­—
<img src="/images/checkout.png" alt="checkout.html"></p>
<p>2.<code>error.html</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE html&gt;</span>
</span></span><span style="display:flex;"><span>&lt;<span style="color:#f92672">html</span> <span style="color:#a6e22e">lang</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">charset</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">meta</span> <span style="color:#a6e22e">name</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">&lt;!-- æ”¹tiltle --&gt;</span>
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">title</span>&gt;LINE Pay Error&lt;/<span style="color:#f92672">title</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">link</span> <span style="color:#a6e22e">rel</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> <span style="color:#a6e22e">href</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% static &#39;dist/bundle.css&#39; %}&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">script</span> <span style="color:#a6e22e">type</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;module&#34;</span> <span style="color:#a6e22e">src</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;{% static &#39;dist/bundle.js&#39; %}&#34;</span>&gt;&lt;/<span style="color:#f92672">script</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">head</span>&gt;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">&lt;!-- å¾Œé¢å†åŠ æ¨£å¼ --&gt;</span>
</span></span><span style="display:flex;"><span>  &lt;<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">h1</span>&gt;ä»˜æ¬¾å¤±æ•—&lt;/<span style="color:#f92672">h1</span>&gt;
</span></span><span style="display:flex;"><span>    &lt;<span style="color:#f92672">p</span>&gt;{{ message }}&lt;/<span style="color:#f92672">p</span>&gt;
</span></span><span style="display:flex;"><span>  &lt;/<span style="color:#f92672">body</span>&gt;
</span></span><span style="display:flex;"><span>&lt;/<span style="color:#f92672">html</span>&gt;
</span></span></code></pre></div><h3 id="2env-ç’°å¢ƒè®Šæ•¸">2..env ç’°å¢ƒè®Šæ•¸</h3>
<p>é€™é‚Šæœ‰äº›é‡è¦çš„ Keyï¼Œæˆ‘å€‘ä¸æƒ³å…¬é–‹ï¼Œæ‰€ä»¥ä¸æœƒæ”¾ä¸Š gitï¼Œ
ç¢ºå®š<code>.env</code>å·²ç¶“è¢«åŠ å…¥<code>.gitignore</code>ï¼Œå¦‚æœæœ‰æˆåŠŸåŠ å…¥<code>.env</code>åœ¨ç›®éŒ„è£¡æœƒå‘ˆç¾ç°è‰²</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#75715e">#è²¼ä¸Šå‰›å‰›åœ¨Line Pay å¾Œå°å¾—åˆ°çš„ï¼Œ&lt;&gt;ä¸ç”¨æ‰“</span>
</span></span><span style="display:flex;"><span>LINE_CHANNEL_ID<span style="color:#f92672">=</span> <span style="color:#f92672">&lt;</span>ä½ çš„channel id<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>LINE_CHANNEL_SECRET_KEY<span style="color:#f92672">=</span> <span style="color:#f92672">&lt;</span>ä½ çš„channel secret_key<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#æ¸¬è©¦ç”¨çš„ï¼Œå¤§å®¶éƒ½ä¸€æ¨£</span>
</span></span><span style="display:flex;"><span>LINE_SANDBOX_URL<span style="color:#f92672">=</span>https:<span style="color:#f92672">//</span>sandbox<span style="color:#f92672">-</span>api<span style="color:#f92672">-</span>pay<span style="color:#f92672">.</span>line<span style="color:#f92672">.</span>me
</span></span><span style="display:flex;"><span>LINE_REQUEST_URL<span style="color:#f92672">=/</span>v3<span style="color:#f92672">/</span>payments<span style="color:#f92672">/</span>request
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æ”¾å‰›å‰›ngrokç¬¬ 3 é»å‡ºç¾çš„è·¯å¾‘ä½ç½®</span>
</span></span><span style="display:flex;"><span>HOSTNAME<span style="color:#f92672">=</span><span style="color:#ae81ff">127.0.0.1</span>:<span style="color:#ae81ff">8080</span>
</span></span></code></pre></div><h3 id="3settingpy">3.setting.py</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è¼‰å…¥.env</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> environ
</span></span><span style="display:flex;"><span>env <span style="color:#f92672">=</span> environ<span style="color:#f92672">.</span>Env()
</span></span><span style="display:flex;"><span>environ<span style="color:#f92672">.</span>Env<span style="color:#f92672">.</span>read_env()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ALLOWED_HOSTS <span style="color:#f92672">=</span> env(<span style="color:#e6db74">&#39;HOSTNAME&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#LINE PAY API çš„ CSRF_TRUSTED_ORIGINS</span>
</span></span><span style="display:flex;"><span>CSRF_TRUSTED_ORIGINS <span style="color:#f92672">=</span> [<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://</span><span style="color:#e6db74">{</span>env(<span style="color:#e6db74">&#39;HOSTNAME&#39;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>]
</span></span></code></pre></div><p>é€™é‚Šå¦‚æœæœ‰ä¸²å…¶ä»–çš„ API æˆ–ç¬¬ä¸‰æ–¹æœå‹™ï¼Œå¦‚ google ç™»å…¥ï¼Œåœ¨<code>ALLOWED_HOSTS = </code>å¯èƒ½æœƒæ‰“æ¶</p>
<ul>
<li>google ç™»å…¥:<code>ALLOWED_HOSTS = os.getenv('ALLOWED_HOSTS', '*').split(',')</code></li>
<li>Line Pay :<code>ALLOWED_HOSTS = env('HOSTNAME')</code></li>
</ul>
<p>é€™å€‹æ™‚å€™ï¼Œæˆ‘å€‘å¯ä»¥é€™éº¼è™•ç†ï¼Œä¾†åŒæ™‚åŒ…å«å…©ç¨®è¨­å®š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#75715e"># googleç™»å…¥ï¼šç²å– ALLOWED_HOSTS çš„å€¼ï¼Œé»˜èªç‚º &#39;*&#39;</span>
</span></span><span style="display:flex;"><span>allowed_hosts_env <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>getenv(<span style="color:#e6db74">&#39;ALLOWED_HOSTS&#39;</span>, <span style="color:#e6db74">&#39;*&#39;</span>)<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39;,&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># LINE PAY API çš„</span>
</span></span><span style="display:flex;"><span>line_pay_hostname <span style="color:#f92672">=</span> env(<span style="color:#e6db74">&#39;HOSTNAME&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆä½µå…©è€…çš„å€¼</span>
</span></span><span style="display:flex;"><span>ALLOWED_HOSTS <span style="color:#f92672">=</span> allowed_hosts_env <span style="color:#f92672">+</span> [line_pay_hostname]
</span></span></code></pre></div><h3 id="4urlspy-è¨­å®šè·¯å¾‘">4.<code>urls.py</code> è¨­å®šè·¯å¾‘</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#f92672">from</span> django.urls <span style="color:#f92672">import</span> path
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> .views <span style="color:#f92672">import</span> request_payment
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app_name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ä½ çš„appåå­—&#34;</span>
</span></span><span style="display:flex;"><span>urlpatterns <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    path(<span style="color:#e6db74">&#39;request/&#39;</span>, request_payment, name<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;request_payment&#39;</span>),
</span></span><span style="display:flex;"><span>]
</span></span></code></pre></div><h3 id="5viewpy-è¨­å®šåŠŸèƒ½">5.<code>view.py</code> è¨­å®šåŠŸèƒ½</h3>
<p>é€™é‚Šå°æˆ‘ä¾†èªªæ˜¯æœ€è¤‡é›œçš„åœ°æ–¹ï¼Œå¦‚æœä½¿ç”¨ Postmanï¼Œåœ¨å°æ‡‰çš„ä½ç½®æ”¾å…¥éœ€è¦çš„å€¼å°±å¥½ï¼Œé€™é‚Šæˆ‘å€‘éœ€è¦è‡ªå·±è¨­å®š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#75715e">#åŸºæœ¬çš„</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> django.shortcuts <span style="color:#f92672">import</span> render, redirect
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> pathlib <span style="color:#f92672">import</span> Path
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#line pay æœƒç”¨åˆ°çš„ï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> uuid
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> hmac
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> environ
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#é€£æ¥.envè®Šæ•¸</span>
</span></span><span style="display:flex;"><span>BASE_DIR <span style="color:#f92672">=</span> Path(__file__)<span style="color:#f92672">.</span>resolve()<span style="color:#f92672">.</span>parent<span style="color:#f92672">.</span>parent
</span></span><span style="display:flex;"><span>env <span style="color:#f92672">=</span> environ<span style="color:#f92672">.</span>Env()
</span></span><span style="display:flex;"><span>environ<span style="color:#f92672">.</span>Env<span style="color:#f92672">.</span>read_env()
</span></span></code></pre></div><p>æœƒæœ‰å…©å€‹éœ€è¦è¨­å®šï¼š<code>header</code>&amp;<code>body</code></p>
<p>1.è¨­å®š<code>header</code>ï¼Œå®˜æ–¹æ–‡ä»¶æœ‰èªª header éœ€è¦çš„æ±è¥¿ï¼Œåœ¨é€™é‚Šæœƒéœ€è¦å¹«é€™äº›è³‡æ–™åŠ å¯†
<a href="https://developers-pay.line.me/zh/online/pre-requisites">å®˜æ–¹æ–‡ä»¶</a>æˆªåœ–ï¼š
<img src="/images/headerSetting.png" alt="headerSetting">
å®˜ç¶²ä¸Šæœ‰ JavaScrip çš„ç¨‹å¼ç¢¼ï¼Œå½ˆ Django æ˜¯ä½¿ç”¨ Pythonï¼Œæ‰€ä»¥æˆ‘å€‘ä¾†è¨­å®šç¨‹å¼ç¢¼ï¼š</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#75715e">#line pay API header</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">create_headers</span>(body, uri):
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#å¸¶å…¥åœ¨.envçš„è³‡è¨Š</span>
</span></span><span style="display:flex;"><span>    channel_id <span style="color:#f92672">=</span> env(<span style="color:#e6db74">&#39;LINE_CHANNEL_ID&#39;</span>)
</span></span><span style="display:flex;"><span>    secret_key <span style="color:#f92672">=</span> env(<span style="color:#e6db74">&#39;LINE_CHANNEL_SECRET_KEY&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#ç”Ÿæˆéš¨æ©Ÿçš„UUIDä¸¦è½‰ç‚ºæ–‡å­—æ ¼å¼ï¼Œç‚ºé˜²æ­¢é‡è¤‡æäº¤</span>
</span></span><span style="display:flex;"><span>    nonce <span style="color:#f92672">=</span> str(uuid<span style="color:#f92672">.</span>uuid4())
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#header è½‰æ›æˆjsonæ ¼å¼</span>
</span></span><span style="display:flex;"><span>    body_to_json <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>dumps(body)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># çµ„è£ç°½å</span>
</span></span><span style="display:flex;"><span>    message <span style="color:#f92672">=</span> secret_key <span style="color:#f92672">+</span> uri <span style="color:#f92672">+</span> body_to_json <span style="color:#f92672">+</span> nonce
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#è½‰äºŒé€²åˆ¶ï¼Œå¾ŒçºŒé›œæ¹Šæ™‚ä½¿ç”¨</span>
</span></span><span style="display:flex;"><span>    binary_message <span style="color:#f92672">=</span> message<span style="color:#f92672">.</span>encode()
</span></span><span style="display:flex;"><span>    binary_secret_key <span style="color:#f92672">=</span> secret_key<span style="color:#f92672">.</span>encode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#é›œæ¹Šï¼Œä½¿ç”¨SHA256</span>
</span></span><span style="display:flex;"><span>    hash <span style="color:#f92672">=</span> hmac<span style="color:#f92672">.</span>new(binary_secret_key, binary_message, hashlib<span style="color:#f92672">.</span>sha256)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#å°‡hashè½‰ç‚ºBase64ç·¨ç¢¼çš„å­—ç¬¦ä¸²</span>
</span></span><span style="display:flex;"><span>    signature <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64encode(hash<span style="color:#f92672">.</span>digest())<span style="color:#f92672">.</span>decode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">#å®˜æ–¹æ–‡ä»¶ä¸­è¨­å®šçš„ï¼ŒæŠŠå‰›è¨­å®šå¥½çš„è®Šæ•¸å¸¶å…¥</span>
</span></span><span style="display:flex;"><span>    headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;X-LINE-ChannelId&#34;</span>:channel_id,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;X-LINE-ChannelSecret&#34;</span>:secret_key,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;X-LINE-Authorization-Nonce&#34;</span>: nonce,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;X-LINE-Authorization&#34;</span>: signature,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> headers
</span></span></code></pre></div><p>2.è¨­å®š<code>body</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-py" data-lang="py"><span style="display:flex;"><span><span style="color:#75715e">#line pay API body</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">request_payment</span>(request):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;POST&#34;</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è¨­å®šè¨‚å–®èˆ‡ä»˜æ¬¾è³‡è¨Š</span>
</span></span><span style="display:flex;"><span>        order_id <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;order_</span><span style="color:#e6db74">{</span>str(uuid<span style="color:#f92672">.</span>uuid4())<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        package_id <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;package_</span><span style="color:#e6db74">{</span>str(uuid<span style="color:#f92672">.</span>uuid4())<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#è¨­å®šå•†å“è³‡è¨Šï¼Œæœƒå‡ºç¾åœ¨Line Payè«‹æ¬¾é é¢è³‡è¨Šä¸­</span>
</span></span><span style="display:flex;"><span>        payload <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;amount&#39;</span>: <span style="color:#ae81ff">399</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;currency&#39;</span>: <span style="color:#e6db74">&#39;TWD&#39;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;orderId&#39;</span>: order_id,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;packages&#39;</span>: [{
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;id&#39;</span>: package_id,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;amount&#39;</span>: <span style="color:#ae81ff">399</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;products&#39;</span>: [{
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;id&#39;</span>: <span style="color:#e6db74">&#39;1&#39;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;name&#39;</span>: <span style="color:#e6db74">&#39;æ–¹æ¡ˆï¼¢è¶…å¥½æª&#39;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;quantity&#39;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;price&#39;</span>: <span style="color:#ae81ff">399</span>,
</span></span><span style="display:flex;"><span>                }]
</span></span><span style="display:flex;"><span>            }],
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;redirectUrls&#39;</span>: {
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;confirmUrl&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://</span><span style="color:#e6db74">{</span>env(<span style="color:#e6db74">&#39;HOSTNAME&#39;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">/payment/confirm&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#39;cancelUrl&#39;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;https://</span><span style="color:#e6db74">{</span>env(<span style="color:#e6db74">&#39;HOSTNAME&#39;</span>)<span style="color:#e6db74">}</span><span style="color:#e6db74">/payment/cancel&#34;</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># ç™¼é€ API è«‹æ±‚</span>
</span></span><span style="display:flex;"><span>        uri <span style="color:#f92672">=</span> env(<span style="color:#e6db74">&#39;LINE_REQUEST_URL&#39;</span>)
</span></span><span style="display:flex;"><span>        headers <span style="color:#f92672">=</span> create_headers(payload, uri)
</span></span><span style="display:flex;"><span>        url <span style="color:#f92672">=</span> <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>env(<span style="color:#e6db74">&#39;LINE_SANDBOX_URL&#39;</span>)<span style="color:#e6db74">}{</span>uri<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>        response <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(url, headers<span style="color:#f92672">=</span>headers, data<span style="color:#f92672">=</span>json<span style="color:#f92672">.</span>dumps(payload))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># æ ¹æ“šç‹€æ…‹ï¼Œè™•ç†å›æ‡‰</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> response<span style="color:#f92672">.</span>status_code <span style="color:#f92672">==</span> <span style="color:#ae81ff">200</span>:
</span></span><span style="display:flex;"><span>            data <span style="color:#f92672">=</span> response<span style="color:#f92672">.</span>json()
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> data[<span style="color:#e6db74">&#39;returnCode&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;0000&#39;</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> redirect(data[<span style="color:#e6db74">&#39;info&#39;</span>][<span style="color:#e6db74">&#39;paymentUrl&#39;</span>][<span style="color:#e6db74">&#39;web&#39;</span>])
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> render(request, <span style="color:#e6db74">&#34;payment/error.html&#34;</span>, {<span style="color:#e6db74">&#34;message&#34;</span>: data[<span style="color:#e6db74">&#39;returnMessage&#39;</span>]})
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> render(request, <span style="color:#e6db74">&#34;payment/error.html&#34;</span>, {<span style="color:#e6db74">&#34;message&#34;</span>: <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Error: </span><span style="color:#e6db74">{</span>response<span style="color:#f92672">.</span>status_code<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> render(request, <span style="color:#e6db74">&#34;payment/checkout.html&#34;</span>)
</span></span></code></pre></div><h2 id="æ¸¬è©¦">æ¸¬è©¦</h2>
<p>è¨­å®šä¹‹å¾Œï¼Œå°±å¯ä»¥é–‹ serverï¼Œåˆ°å‰é¢è¨­å®šçš„è·¯å¾‘å»çœ‹é é¢
<img src="/images/checkout.png" alt="checkout.html"></p>
<h3 id="æˆåŠŸé€£æ¥">æˆåŠŸé€£æ¥</h3>
<p>æŒ‰ä¸‹<code>å‰å¾€ä»˜æ¬¾</code>ï¼ŒæˆåŠŸçš„è©±æœƒé€²å…¥ä¸‹é¢çš„é é¢ï¼ˆLine ç³»çµ±é é¢ï¼‰
<img src="/images/connectLinePay.png" alt="connectLinePay.html">
æƒæ QR Code æˆ–æ˜¯ç™»å…¥å¾Œï¼Œæœƒé€²åˆ°ä»˜æ¬¾é é¢ï¼ˆLine ç³»çµ±é é¢ï¼‰
<img src="/images/testCheckout.jpg" alt="test"></p>
<h3 id="é€£æ¥å¤±æ•—">é€£æ¥å¤±æ•—</h3>
<p>ä½†å¦‚æœæŒ‰ä¸‹<code>å‰å¾€ä»˜æ¬¾</code>ï¼Œçœ‹åˆ°çš„æ˜¯éŒ¯èª¤é é¢ï¼Œä»£è¡¨é€£ç·šæ²’æœ‰æˆåŠŸï¼Œéœ€è¦å†çœ‹çœ‹è¨­å®šå“ªé‚Šæœ‰å•é¡Œ
<img src="/images/error.jpg" alt="error"></p>
<p>æˆåŠŸä¹‹å¾Œå°±æ˜¯ä¾†å’Œå…¶ä»–çš„ app åšä¸²æ¥ï¼Œä¸‹ä¸€ç¯‡å†ä»‹ç´¹å›‰</p>

      
      <div class="divider"></div>
      <div class="flex flex-col md:flex-row justify-between gap-4 py-4">
        
        <a class="group btn btn-outline" href="/posts/18th-googlemap/" title="Google Map ">
          <ion-icon name="chevron-back"></ion-icon>
          <div class="inline-flex flex-col items-start">
            <span class="text-base-content/60 group-hover:text-neutral-content/60 text-xs font-normal">Previous page</span>
            <span class="max-w-48 truncate">Google Map </span>
          </div>
        </a>
        

        
        <a class="group btn btn-outline" href="/posts/18th-readme/" title="Moordule-README">
          <div class="inline-flex flex-col items-end">
            <span class="text-base-content/60 group-hover:text-neutral-content/60 text-xs font-normal">Next page</span>
            <span class="max-w-48 truncate">Moordule-README</span>
          </div>
          <ion-icon name="chevron-forward"></ion-icon>
        </a>
        
      </div>
      
    </article>
  </div>

  
</div>


            
<footer class="flex justify-between items-center gap-2 px-4 py-12">

  <div>
  
  <p>
    Â© 2024 - 2025 Joanna&#39;s Blog
  </p>
  

  
  <p>ğŸŒŸ A Hugo theme named Dream</p>
  
</div>

  <div
  x-data="{ icons: [
    { name: 'moon', status: 'y' },
    { name: 'sunny', status: 'n' },
    { name: 'desktop', status: 'auto' }
  ] }"
  class="flex items-center h-[32px] px-2 gap-2 border border-base-content/30 rounded-full"
>
  <template x-for="icon in icons">
    <div
      role="button"
      tabindex="0"
      :aria-label="'Select ' + icon.name + ' mode'"
      class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary"
      :class="$store.darkMode.icon() === icon.name && 'bg-primary'"
      @click="$store.darkMode.toggle(icon.status)"
    >
      <ion-icon
        :name="`${icon.name}-outline`"
        class="group-hover:text-primary-content"
        :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"
      >
      </ion-icon>
    </div>
  </template>
</div>

</footer>

          </div>
        </div>
        <div class="back">
          <div class="container">
            
            <div class="dream-grid dream-grid-about">
  
  
  
  <div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column">
    <article
      class="card card-compact bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"
    >
      <div class="card-body">
        <div class="card-title">About Me</div>

        <div class="prose dark:prose-invert">
          <p>Hello I&rsquo;m Joanna, this is my blog</p>
<p>æˆ‘æœƒåœ¨é€™é‚Šåˆ†äº«æˆ‘å­¸ç¿’ç¨‹å¼èªè¨€çš„å¿ƒå¾—èˆ‡ç­†è¨˜</p>
        </div>
      </div>
    </article>
  </div>
  
  

  

  
</div>

            

            
<footer class="flex justify-between items-center gap-2 px-4 py-12">

  <div>
  
  <p>
    Â© 2024 - 2025 Joanna&#39;s Blog
  </p>
  

  
  <p>ğŸŒŸ A Hugo theme named Dream</p>
  
</div>

  <div
  x-data="{ icons: [
    { name: 'moon', status: 'y' },
    { name: 'sunny', status: 'n' },
    { name: 'desktop', status: 'auto' }
  ] }"
  class="flex items-center h-[32px] px-2 gap-2 border border-base-content/30 rounded-full"
>
  <template x-for="icon in icons">
    <div
      role="button"
      tabindex="0"
      :aria-label="'Select ' + icon.name + ' mode'"
      class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary"
      :class="$store.darkMode.icon() === icon.name && 'bg-primary'"
      @click="$store.darkMode.toggle(icon.status)"
    >
      <ion-icon
        :name="`${icon.name}-outline`"
        class="group-hover:text-primary-content"
        :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"
      >
      </ion-icon>
    </div>
  </template>
</div>

</footer>

          </div>
        </div>
      </div>
    </div>

    <script>
  window.lightTheme = "emerald"
  window.darkTheme = "forest"
</script>


  <script src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>

  
  
    
  
  <script src="/js/grid.min.js"></script>




  

<script src="/js/main.min.js"></script>

    







    

    

    

    <script type="module" src="https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.js"></script>
  </body>
</html>
